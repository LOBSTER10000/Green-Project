<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sunny.green.dao.BbsDao">

    <!-- Q&A 리스트 -->
    <select id="selectBoardAll" resultType="com.sunny.green.vo.BbsVo">
        select * from board order by board_date desc
    </select>

    <!-- Q&A 등록 -->
    <insert id="insertBoard" useGeneratedKeys="true" keyProperty="board_num">
        insert into board(board_num, board_title, user_id, board_content, board_date) values (#{board_num}, #{board_title}, #{user_id}, #{board_content}, NOW())
    </insert>

    <!-- Q&A 상세 -->
    <select id="selectBoard" resultType="com.sunny.green.vo.BbsVo">
        select *
        from board
        where board_num = #{board_num}
    </select>

    <!-- Q&A 수정-->
    <update id="updateBoard">
        update board
        set board_title = #{board_title},
            board_content = #{board_content}
        where board_num = #{board_num}
    </update>

    <!-- Q&A 삭제-->
    <delete id="deleteBoard">
        delete
        from board
        where board_num = #{board_num}
    </delete>


<!--    &lt;!&ndash; 번호 자동 조정 &ndash;&gt;-->
<!--    <update id="updateBoardNum">-->
<!--        <selectKey keyProperty="board_num" order="BEFORE">-->
<!--            SELECT @num := 0-->
<!--        </selectKey>-->
<!--        UPDATE board, (SELECT @num := 0) r-->
<!--        SET board.board_num = (@num := @num + 1)-->
<!--    </update>-->

      <select id="selectAllBoard" resultType="com.sunny.green.vo.BbsVo">
          select * from board;
      </select>

    <!--    rsList 검색  -->
    <select id="searchBoard" resultType="com.sunny.green.vo.BbsVo">
        SELECT *
        FROM bbs;
        <where>
            <if test="searchType=='board_title' and keyword != null and keyword != '' ">
                AND board_title like CONCAT('%', #{keyword}, '%')
            </if>
            <if test="searchType=='user_id' and keyword != null and keyword != '' ">
                AND user_id like CONCAT('%', #{keyword}, '%')
            </if>
            <if test="searchType=='board_date' and keyword != null and keyword != '' ">
                AND board_date like CONCAT('%', #{keyword}, '%')
            </if>
        </where>
    </select>
</mapper>